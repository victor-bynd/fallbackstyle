
> fallback-style@1.0.3 test
> vitest src/tests/ReproductionStartWithFonts.test.jsx run


[1m[44m DEV [49m[22m [34mv4.0.16 [39m[90m/Users/victortolosa/Documents/GitHub/fallbackstyle[39m

[90mstderr[2m | src/tests/ReproductionStartWithFonts.test.jsx[2m > [22m[2mStart with Fonts Flow Reproduction[2m > [22m[2mshould not corrupt Global Primary Font when mapped explicitly
[22m[39mAn update to TypoProvider inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TypoProvider inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act


<--- Last few GCs --->

[53421:0xaba40c000]    49017 ms: Scavenge (during sweeping) 4088.9 (4097.7) -> 4088.0 (4098.0) MB, pooled: 0.0 MB, 16.96 / 0.00 ms (average mu = 0.360, current mu = 0.347) allocation failure; 
[53421:0xaba40c000]    51917 ms: Mark-Compact (reduce) 4091.5 (4100.0) -> 4087.9 (4096.5) MB, pooled: 0.0 MB, 1356.69 / 0.00 ms (+ 283.6 ms in 55 steps since start of marking, biggest step 6.5 ms, walltime since start of marking 1773 ms) (average mu = 0.3
FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory
----- Native stack trace -----

 1: 0x100e598ac node::OOMErrorHandler(char const*, v8::OOMDetails const&) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
 2: 0x100f8836c v8::Utils::ReportOOMFailure(v8::internal::Isolate*, char const*, v8::OOMDetails const&) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
 3: 0x100f88324 v8::internal::V8::FatalProcessOutOfMemory(v8::internal::Isolate*, char const*, v8::OOMDetails const&) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
 4: 0x101135b68 v8::internal::Heap::ShouldOptimizeForLoadTime() const [/opt/homebrew/Cellar/node/25.2.0/bin/node]
 5: 0x101138130 v8::internal::Heap::OldGenerationConsumedBytes() const [/opt/homebrew/Cellar/node/25.2.0/bin/node]
 6: 0x101137fd8 v8::internal::Heap::RecomputeLimits(v8::internal::GarbageCollector, v8::base::TimeTicks) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
 7: 0x101145a24 v8::internal::Heap::CollectGarbage(v8::internal::AllocationSpace, v8::internal::GarbageCollectionReason, v8::GCCallbackFlags, v8::internal::PerformHeapLimitCheck)::$_1::operator()() const [/opt/homebrew/Cellar/node/25.2.0/bin/node]
 8: 0x1011456c8 void heap::base::Stack::SetMarkerAndCallbackImpl<v8::internal::Heap::CollectGarbage(v8::internal::AllocationSpace, v8::internal::GarbageCollectionReason, v8::GCCallbackFlags, v8::internal::PerformHeapLimitCheck)::$_1>(heap::base::Stack*, void*, void const*) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
 9: 0x101762618 PushAllRegistersAndIterateStack [/opt/homebrew/Cellar/node/25.2.0/bin/node]
10: 0x1011342e8 v8::internal::Heap::CollectGarbage(v8::internal::AllocationSpace, v8::internal::GarbageCollectionReason, v8::GCCallbackFlags, v8::internal::PerformHeapLimitCheck) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
11: 0x10112ca3c std::__1::invoke_result<v8::internal::HeapAllocator::AllocateRawWithRetryOrFailSlowPath(int, v8::internal::AllocationType, v8::internal::AllocationOrigin, v8::internal::AllocationAlignment, v8::internal::AllocationHint)::$_0&>::type v8::internal::HeapAllocator::CollectGarbageAndRetryAllocation<v8::internal::HeapAllocator::AllocateRawWithRetryOrFailSlowPath(int, v8::internal::AllocationType, v8::internal::AllocationOrigin, v8::internal::AllocationAlignment, v8::internal::AllocationHint)::$_0&>(v8::internal::HeapAllocator::AllocateRawWithRetryOrFailSlowPath(int, v8::internal::AllocationType, v8::internal::AllocationOrigin, v8::internal::AllocationAlignment, v8::internal::AllocationHint)::$_0&, v8::internal::AllocationType) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
12: 0x10112b8ac v8::internal::HeapAllocator::AllocateRawWithRetryOrFailSlowPath(int, v8::internal::AllocationType, v8::internal::AllocationOrigin, v8::internal::AllocationAlignment, v8::internal::AllocationHint) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
13: 0x101113d68 v8::internal::Factory::NewFillerObject(int, v8::internal::AllocationAlignment, v8::internal::AllocationType, v8::internal::AllocationOrigin) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
14: 0x101423b54 v8::internal::Runtime_AllocateInYoungGeneration(int, unsigned long*, v8::internal::Isolate*) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
15: 0x101821474 Builtins_CEntry_Return1_ArgvOnStack_NoBuiltinExit [/opt/homebrew/Cellar/node/25.2.0/bin/node]
16: 0x12d8833a4 
17: 0x12d730014 
18: 0x12d8da814 
19: 0x12d7a0110 
20: 0x12d8f14a0 
21: 0x12d7c7f78 
22: 0x12d7c5f40 
23: 0x12d7237ac 
24: 0x12d7d43f4 
25: 0x1017815ec Builtins_InterpreterEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
26: 0x1017815ec Builtins_InterpreterEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
27: 0x1017815ec Builtins_InterpreterEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
28: 0x1017815ec Builtins_InterpreterEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
29: 0x1017815ec Builtins_InterpreterEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
30: 0x1017815ec Builtins_InterpreterEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
31: 0x1017815ec Builtins_InterpreterEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
32: 0x1017815ec Builtins_InterpreterEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
33: 0x1018946b0 Builtins_PromiseConstructor [/opt/homebrew/Cellar/node/25.2.0/bin/node]
34: 0x101781f90 Builtins_InterpreterPushArgsThenFastConstructFunction [/opt/homebrew/Cellar/node/25.2.0/bin/node]
35: 0x101911020 Builtins_ConstructHandler [/opt/homebrew/Cellar/node/25.2.0/bin/node]
36: 0x1017815ec Builtins_InterpreterEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
37: 0x1017815ec Builtins_InterpreterEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
38: 0x12d67b44c 
39: 0x1017815ec Builtins_InterpreterEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
40: 0x1017815ec Builtins_InterpreterEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
41: 0x1017bf4c4 Builtins_AsyncFunctionAwaitResolveClosure [/opt/homebrew/Cellar/node/25.2.0/bin/node]
42: 0x101896058 Builtins_PromiseFulfillReactionJob [/opt/homebrew/Cellar/node/25.2.0/bin/node]
43: 0x1017ae920 Builtins_RunMicrotasks [/opt/homebrew/Cellar/node/25.2.0/bin/node]
44: 0x10177e850 Builtins_JSRunMicrotasksEntry [/opt/homebrew/Cellar/node/25.2.0/bin/node]
45: 0x1010a06a4 v8::internal::(anonymous namespace)::Invoke(v8::internal::Isolate*, v8::internal::(anonymous namespace)::InvokeParams const&) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
46: 0x1010a0d54 v8::internal::(anonymous namespace)::InvokeWithTryCatch(v8::internal::Isolate*, v8::internal::(anonymous namespace)::InvokeParams const&) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
47: 0x1010a0e44 v8::internal::Execution::TryRunMicrotasks(v8::internal::Isolate*, v8::internal::MicrotaskQueue*) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
48: 0x1010c2500 v8::internal::MicrotaskQueue::RunMicrotasks(v8::internal::Isolate*) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
49: 0x1010c231c v8::internal::MicrotaskQueue::PerformCheckpointInternal(v8::Isolate*) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
50: 0x101783298 Builtins_CallApiCallbackGeneric [/opt/homebrew/Cellar/node/25.2.0/bin/node]
51: 0x12d767074 
52: 0x10177e96c Builtins_JSEntryTrampoline [/opt/homebrew/Cellar/node/25.2.0/bin/node]
53: 0x10177e610 Builtins_JSEntry [/opt/homebrew/Cellar/node/25.2.0/bin/node]
54: 0x1010a06d4 v8::internal::(anonymous namespace)::Invoke(v8::internal::Isolate*, v8::internal::(anonymous namespace)::InvokeParams const&) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
55: 0x1010a00b8 v8::internal::Execution::Call(v8::internal::Isolate*, v8::internal::DirectHandle<v8::internal::Object>, v8::internal::DirectHandle<v8::internal::Object>, v8::base::Vector<v8::internal::DirectHandle<v8::internal::Object> const>) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
56: 0x101eff14c v8::Function::Call(v8::Isolate*, v8::Local<v8::Context>, v8::Local<v8::Value>, int, v8::Local<v8::Value>*) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
57: 0x100dc4c30 node::InternalCallbackScope::Close() [/opt/homebrew/Cellar/node/25.2.0/bin/node]
58: 0x100dc4eb4 node::InternalMakeCallback(node::Environment*, v8::Local<v8::Object>, v8::Local<v8::Object>, v8::Local<v8::Function>, int, v8::Local<v8::Value>*, node::async_context, v8::Local<v8::Value>) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
59: 0x100dd0c34 node::AsyncWrap::MakeCallback(v8::Local<v8::Function>, int, v8::Local<v8::Value>*) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
60: 0x100f0dc18 node::StreamBase::CallJSOnreadMethod(long, v8::Local<v8::ArrayBuffer>, unsigned long, node::StreamBase::StreamBaseJSChecks) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
61: 0x100f0f000 node::EmitToJSStreamListener::OnStreamRead(long, uv_buf_t const&) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
62: 0x100f11750 node::LibuvStreamWrap::OnUvRead(long, uv_buf_t const*) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
63: 0x100f11b54 node::LibuvStreamWrap::ReadStart()::$_1::__invoke(uv_stream_s*, long, uv_buf_t const*) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
64: 0x104ed3664 uv__stream_io [/opt/homebrew/Cellar/libuv/1.51.0/lib/libuv.1.0.0.dylib]
65: 0x104ed8e2c uv__io_poll [/opt/homebrew/Cellar/libuv/1.51.0/lib/libuv.1.0.0.dylib]
66: 0x104ecaa00 uv_run [/opt/homebrew/Cellar/libuv/1.51.0/lib/libuv.1.0.0.dylib]
67: 0x100dc55c8 node::SpinEventLoopInternal(node::Environment*) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
68: 0x100e847e4 node::NodeMainInstance::Run(node::ExitCode*, node::Environment*) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
69: 0x100e84518 node::NodeMainInstance::Run() [/opt/homebrew/Cellar/node/25.2.0/bin/node]
70: 0x100e32754 node::Start(int, char**) [/opt/homebrew/Cellar/node/25.2.0/bin/node]
71: 0x18e545d54 start [/usr/lib/dyld]
[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Unhandled Errors [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m
[31m[1m
Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Unhandled Error [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m
[31m[1mError[22m: [vitest-pool]: Worker forks emitted error.[39m
[90m [2m‚ùØ[22m EventEmitter.<anonymous> node_modules/vitest/dist/chunks/cli-api.BKg19Fvw.js:[2m8015:22[22m[39m
[90m [2m‚ùØ[22m EventEmitter.emit node:events:[2m508:28[22m[39m
[90m [2m‚ùØ[22m ChildProcess.emitUnexpectedExit node_modules/vitest/dist/chunks/cli-api.BKg19Fvw.js:[2m7588:22[22m[39m
[90m [2m‚ùØ[22m ChildProcess.emit node:events:[2m508:28[22m[39m
[90m [2m‚ùØ[22m Process.ChildProcess._handle.onexit node:internal/child_process:[2m293:12[22m[39m

[31m[1mCaused by: Error[22m: Worker exited unexpectedly[39m
[90m [2m‚ùØ[22m ChildProcess.emitUnexpectedExit node_modules/vitest/dist/chunks/cli-api.BKg19Fvw.js:[2m7587:33[22m[39m
[90m [2m‚ùØ[22m ChildProcess.emit node:events:[2m508:28[22m[39m
[90m [2m‚ùØ[22m Process.ChildProcess._handle.onexit node:internal/child_process:[2m293:12[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m


[2m Test Files [22m [90m (1)[39m
[2m      Tests [22m [90m (2)[39m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 08:40:46
[2m   Duration [22m 53.25s[2m (transform 671ms, setup 681ms, import 740ms, tests 0ms, environment 2.50s)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2msrc/context/TypoContext.jsx [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34msrc/tests/ReproductionStartWithFonts.test.jsx, run[39m

[90mstderr[2m | src/tests/ReproductionStartWithFonts.test.jsx[2m > [22m[2mStart with Fonts Flow Reproduction[2m > [22m[2mshould not corrupt Global Primary Font when mapped explicitly
[22m[39mAn update to TypoProvider inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
An update to TypoProvider inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

